<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tag: Java | 谢晞鸣的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="谢晞鸣的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="谢晞鸣的博客">
<meta property="og:url" content="http://yoursite.com/tags/Java/page/3/index.html">
<meta property="og:site_name" content="谢晞鸣的博客">
<meta property="og:description" content="谢晞鸣的博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="谢晞鸣的博客">
<meta name="twitter:description" content="谢晞鸣的博客">
  
    <link rel="alternative" href="/atom.xml" title="谢晞鸣的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script>
  <script>AV.initialize("t0oo3lf98OPPpD4kenk6vFYf-gzGzoHsz", "FtwKfgFgc5fELEvKhCGUmBBO");</script>
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://wx1.sinaimg.cn/mw690/6a2787d4gy1fthip0widbj20pu0pw43p.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">小谢</a></h1>
		</hgroup>

		
		<p class="header-subtitle">蚂蚁金服国际事业群前后端工程师火热招聘中，有兴趣扫码加微信聊</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/fdx321" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/fdx321" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/xie-xi-ming" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:fdx321@126.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/BloomFilter/" style="font-size: 10px;">BloomFilter</a> <a href="/tags/Groovy/" style="font-size: 10px;">Groovy</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Motan/" style="font-size: 16px;">Motan</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Netty/" style="font-size: 10px;">Netty</a> <a href="/tags/Nio/" style="font-size: 10px;">Nio</a> <a href="/tags/Python/" style="font-size: 12px;">Python</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/RocketMQ/" style="font-size: 16px;">RocketMQ</a> <a href="/tags/Scala/" style="font-size: 10px;">Scala</a> <a href="/tags/Scrapy/" style="font-size: 14px;">Scrapy</a> <a href="/tags/Spring/" style="font-size: 12px;">Spring</a> <a href="/tags/Tomcat/" style="font-size: 18px;">Tomcat</a> <a href="/tags/XXL-JOB/" style="font-size: 10px;">XXL-JOB</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/事务/" style="font-size: 10px;">事务</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/博客/" style="font-size: 14px;">博客</a> <a href="/tags/可视化/" style="font-size: 10px;">可视化</a> <a href="/tags/收藏/" style="font-size: 10px;">收藏</a> <a href="/tags/爬虫/" style="font-size: 14px;">爬虫</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://nba.hupu.com/">虎扑篮球</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.jobbole.com/">伯乐在线</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.importnew.com/">ImportNew</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">某互联网金融公司资浅工程师.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">小谢</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://wx1.sinaimg.cn/mw690/6a2787d4gy1fthip0widbj20pu0pw43p.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">小谢</h1>
			</hgroup>
			
			<p class="header-subtitle">蚂蚁金服国际事业群前后端工程师火热招聘中，有兴趣扫码加微信聊</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/fdx321" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/fdx321" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/xie-xi-ming" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:fdx321@126.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-【Motan源码学习】5-心跳机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/24/【Motan源码学习】5-心跳机制/" class="article-date">
  	<time datetime="2017-07-24T14:40:11.000Z" itemprop="datePublished">2017-07-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/24/【Motan源码学习】5-心跳机制/">【Motan源码学习】5-心跳机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Motan的心跳机制有两种，一种是Server(或者说服务发布者)发给注册中心的，一种是Client(或者说服务引用者)发给Server的。</p>
<h3 id="Server-HeartBeat-to-Registry"><a href="#Server-HeartBeat-to-Registry" class="headerlink" title="Server HeartBeat to Registry"></a><strong>Server HeartBeat to Registry</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AbstractRegistry</span><span class="params">(URL url)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.registryUrl = url.createCopy();</span><br><span class="line">    MotanSwitcherUtil.registerSwitcherListener(MotanConstants.REGISTRY_HEARTBEAT_SWITCHER, <span class="keyword">new</span> SwitcherListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onValueChanged</span><span class="params">(String key, Boolean value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; value != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (value) &#123;</span><br><span class="line">                    available(<span class="keyword">null</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    unavailable(<span class="keyword">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在创建Registry的时候会为REGISTRY_HEARTBEAT_SWITCHER这个开关，注册一个监听器，当开关的值发生变更的时候，执行相应的操作。<strong>这个机制是为了实现Server的预览以及优雅停机，Server跟zk等注册中心建立链接后，服务是unreachable状态，此时并不会真正对外提供服务。可以在unreachable状态下进行预览，确认服务正常后，在打开心跳开关，正式提供服务。服务下线时也是先停止心跳变为unreachable状态，等确认没有client调用后就可以停止服务了。</strong><br>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Motan/">Motan</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/24/【Motan源码学习】5-心跳机制/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Motan源码学习】4-服务发布和引用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/23/【Motan源码学习】4-服务发布和引用/" class="article-date">
  	<time datetime="2017-07-23T14:18:37.000Z" itemprop="datePublished">2017-07-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/23/【Motan源码学习】4-服务发布和引用/">【Motan源码学习】4-服务发布与引用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="服务发布"><a href="#服务发布" class="headerlink" title="服务发布"></a><strong>服务发布</strong></h3><p><img src="/images/【Motan源码学习】4-服务发布与引用_1.png" alt=""><br>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Motan/">Motan</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/23/【Motan源码学习】4-服务发布和引用/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Motan源码学习】3-扩展机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/22/【Motan源码学习】3-扩展机制/" class="article-date">
  	<time datetime="2017-07-22T14:18:37.000Z" itemprop="datePublished">2017-07-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/22/【Motan源码学习】3-扩展机制/">【Motan源码学习】3-扩展机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>RPC 框架中有很多地方需要可扩展，比如，序列化（Thrift, Protocol Buffer, Hessian等），LoadBalance策略（随机、权重、Round Robin等），这些东西都要方便扩展且可以在配置文件中指定使用哪一种。<br>Motan 使用了一种 SPI （Service Provider Interface）的机制，实现上和阿里的 <a href="https://github.com/alibaba/cooma" target="_blank" rel="noopener">cooma</a> 类似。本质上都是定义一个接口，该接口可以有很多实现，代码中面向接口编程，但具体使用哪个实现可以在配置文件中指定，然后用反射的机制去加载和使用它。只不过看实现的是否优雅。</p>
<p><img src="/images/【Motan源码学习】3-扩展机制_1.png" alt="400"><br>motan-core 模块中的 META-INF/services 定义了一系列扩展点。文件名为接口名，文件内容为接口的实现类名, 可以配置多个实现类，每个类名占一行。<br>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Motan/">Motan</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/22/【Motan源码学习】3-扩展机制/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Motan源码学习】2-与Spring集成" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/21/【Motan源码学习】2-与Spring集成/" class="article-date">
  	<time datetime="2017-07-21T14:56:11.000Z" itemprop="datePublished">2017-07-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/21/【Motan源码学习】2-与Spring集成/">【Motan源码学习】2-与Spring集成</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>motan-core#com.weibo.api.motan.config 这个 package 定义了一系列 Config 类，用于处理服务发布和服务引用的一些配置。<br>关于Config, Motan 支持三种使用方式：</p>
<ul>
<li>编程 API</li>
<li>与 Spring 集成的 XML 配置</li>
<li>与 Spring 集成的 Annotation 配置<br>我们先来看下编程 API 的使用方式，然后看看 Motan 是如何与 Spring 集成的，本文假设你已经对 Spring 的启动过程和一些 hook 接口有基本的了解。</li>
</ul>
<h3 id="编程-API"><a href="#编程-API" class="headerlink" title="编程 API"></a><strong>编程 API</strong></h3><p><strong>1. 服务发布</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ServiceConfig&lt;MotanDemoService&gt; motanDemoService = <span class="keyword">new</span> ServiceConfig&lt;MotanDemoService&gt;();</span><br><span class="line"><span class="comment">// 设置接口及实现类</span></span><br><span class="line">motanDemoService.setInterface(MotanDemoService.class);</span><br><span class="line">motanDemoService.setRef(<span class="keyword">new</span> MotanDemoServiceImpl());</span><br><span class="line"><span class="comment">// 配置服务的group以及版本号</span></span><br><span class="line">motanDemoService.setGroup(<span class="string">"motan-demo-rpc"</span>);</span><br><span class="line">motanDemoService.setVersion(<span class="string">"1.0"</span>);</span><br><span class="line"><span class="comment">// 配置ZooKeeper注册中心</span></span><br><span class="line">RegistryConfig zookeeperRegistry = <span class="keyword">new</span> RegistryConfig();</span><br><span class="line">zookeeperRegistry.setRegProtocol(<span class="string">"zookeeper"</span>);</span><br><span class="line">zookeeperRegistry.setAddress(<span class="string">"127.0.0.1:2181"</span>);</span><br><span class="line">motanDemoService.setRegistry(zookeeperRegistry);</span><br><span class="line"><span class="comment">// 配置RPC协议</span></span><br><span class="line">ProtocolConfig protocol = <span class="keyword">new</span> ProtocolConfig();</span><br><span class="line">protocol.setId(<span class="string">"motan"</span>);</span><br><span class="line">protocol.setName(<span class="string">"motan"</span>);</span><br><span class="line">motanDemoService.setProtocol(protocol);</span><br><span class="line">motanDemoService.setExport(<span class="string">"motan:8002"</span>);</span><br><span class="line"><span class="comment">// 服务发布</span></span><br><span class="line">motanDemoService.export();</span><br></pre></td></tr></table></figure></p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Motan/">Motan</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/21/【Motan源码学习】2-与Spring集成/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Motan源码学习】1-总体架构" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/19/【Motan源码学习】1-总体架构/" class="article-date">
  	<time datetime="2017-07-19T07:26:56.000Z" itemprop="datePublished">2017-07-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/19/【Motan源码学习】1-总体架构/">【Motan源码学习】1-总体架构</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>【Motan源码学习】系列，不搞大而虚的架构，还是会继续深入源码，剖析RPC框架的内幕，会尝试总结出一些好的系统设计，尝试带着问题去看源码。搞这个系列最主要的目的是驱动自己认真的读源码。虽然说不搞大而虚的架构，但脑子里还是需要一幅大图的. 看过 Tomcat 源码之后深有体会，刚开始掌握大概流程和整体架构，然后一步步深入，搞懂图中的每个组件。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a><strong>简介</strong></h3><p>Motan 是微博研发并开源的 Java 的 RPC 框架，项目地址：<a href="https://github.com/weibocom/motan" target="_blank" rel="noopener">https://github.com/weibocom/motan</a>. 我将在 0.3.1 版本上开始源码的学习。（为什么你不去看 dubbo 呢？dubbo 虽然很屌，除了阿里，在国内很多其他互联网公司也都用它。然。。。我大概过了一遍两个项目，觉得 Motan 更小而美一点，可能看源码的门槛低一点吧）<br>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Motan/">Motan</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/19/【Motan源码学习】1-总体架构/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】15-Connector" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/14/【Tomcat学习笔记】15-Connector/" class="article-date">
  	<time datetime="2017-07-14T09:50:01.000Z" itemprop="datePublished">2017-07-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/14/【Tomcat学习笔记】15-Connector/">【Tomcat学习笔记】15-Connector</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Connector配置"><a href="#Connector配置" class="headerlink" title="Connector配置"></a><strong>Connector配置</strong></h3><p>Connector 属于 StandardService 里的一个组件，可以在 server.xml 中配置，指定协议、端口、超时时间等。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span>                         </span><br><span class="line"><span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>每个 Service 里可以配置多个 Connector. Tomcat 的 Connector 支持两种协议，HTTP 和 AJP. 关于这两种协议，官方文档如此说：</p>
<ul>
<li><em>The HTTP connector is setup by default with Tomcat, and is ready to use. This connector features the lowest latency and best overall performance.</em></li>
<li><em>When using a single server, the performance when using a native webserver in front of the Tomcat instance is most of the time significantly worse than a standalone Tomcat with its default HTTP connector, even if a large part of the web application is made of static files. If integration with the native webserver is needed for any reason, an AJP connector will provide faster performance than proxied HTTP. AJP clustering is the most efficient from the Tomcat perspective. It is otherwise functionally equivalent to HTTP clustering.</em>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/14/【Tomcat学习笔记】15-Connector/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】14-Cluster" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/12/【Tomcat学习笔记】14-Cluster/" class="article-date">
  	<time datetime="2017-07-12T01:53:18.000Z" itemprop="datePublished">2017-07-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/12/【Tomcat学习笔记】14-Cluster/">【Tomcat学习笔记】14-Cluster</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Tomcat Cluster 这块代码较多，就不贴代码一步步看了，这里从更宏观的视角分析和总结一下。代码主要在 org.apache.catalina.ha 和 org.apache.catalina.tribes 两个package. ha这个package主要做了两件事，或者说Tomcat cluster 主要就做了这两件事：集群间 Session 同步 和 集群War部署。tribes 则是Tomcat 集群通讯模块。</p>
<p><img src="/images/【Tomcat学习笔记】Cluster_1.png" alt=""></p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/12/【Tomcat学习笔记】14-Cluster/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】13-Session" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/04/【Tomcat学习笔记】13-Session/" class="article-date">
  	<time datetime="2017-07-04T12:25:38.000Z" itemprop="datePublished">2017-07-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/04/【Tomcat学习笔记】13-Session/">【Tomcat学习笔记】13-Session</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>说明，为了简洁，这里贴的代码可能有所删减。</em></p>
<h3 id="1-Session入门"><a href="#1-Session入门" class="headerlink" title="1. Session入门"></a><strong>1. Session入门</strong></h3><p>网上会经常看到介绍Session和Cookie区别的文章，当年我也傻傻的看过，然这两个根本不是一个东西，有啥好比较的，简直就好比问TCP和JAVA的区别。</p>
<p>Session 是什么？我就不去抄维基百科了，谢晞鸣的理解：HTTP协议本身是无状态的（所谓无状态，就是指前后两HTTP请求是独立的，后面的HTTP请求没法知道前面那次做了啥），但在很多场景中，我们需要有状态，比如用户的登录态，而 Session 就是这样一种让应用有状态的机制。</p>
<p>Session 最简单的用法是:<br>【1】在登录方法中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Boolean isLogin = login(userId, password)</span><br><span class="line"><span class="keyword">if</span>(isLogin) &#123;</span><br><span class="line">    HttpSession session = request.getSession();</span><br><span class="line">    session.setAttribute(<span class="string">"userId"</span>, userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/04/【Tomcat学习笔记】13-Session/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/tags/Java/page/2/">&laquo; Prev</a><a class="page-number" href="/tags/Java/">1</a><a class="page-number" href="/tags/Java/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/tags/Java/page/4/">4</a><a class="page-number" href="/tags/Java/page/5/">5</a><a class="page-number" href="/tags/Java/page/6/">6</a><a class="extend next" rel="next" href="/tags/Java/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 小谢
    	</div>
      <span id="access-count">
      </span>
      <div class="footer-right">
      	<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      </div>
    </div>
  </div>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: false,
		isArchive: false,
		isTag: true,
		isCategory: false,
		open_in_new: true
	}
</script>
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!--page counter part-->
<script>
function addCount (Counter) {
        var query1=new AV.Query(Counter);
        query1.equalTo("url","totalCount");
        query1.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("url","totalCount");
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                          console.log('New object created');
                        },
                        error: function(newcounter,error){
                          console.log('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                console.log('Error:'+error.code+" "+error.message);
            }
        });

        url=$('.article-date').attr('href').trim();
        title = $('.article-title').text().trim();
        var query2=new AV.Query(Counter);
        query2.equalTo("url",url);
        query2.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("title",title);
                    newcounter.set("url",url);
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                          console.log('New object created');
                        },
                        error: function(newcounter,error){
                          console.log('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                console.log('Error:'+error.code+" "+error.message);
            }
        });
}
$(function(){
        var Counter=AV.Object.extend("Counter");
        //only increse visit counting when intering a page
        if ($('.article-title').length == 1){
           addCount(Counter);
         }

        var query=new AV.Query(Counter);
        query.equalTo("url","totalCount");
        query.find({
            success: function(results){
              $('#access-count').text(results[0].get('time'));
            },
            error: function(error){
                console.log("Error:"+error.code+" "+error.message);
            }
        });
});
</script>

  </div>
</body>
</html>