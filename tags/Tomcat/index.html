<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tag: Tomcat | 谢晞鸣的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="谢晞鸣的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="谢晞鸣的博客">
<meta property="og:url" content="http://yoursite.com/tags/Tomcat/index.html">
<meta property="og:site_name" content="谢晞鸣的博客">
<meta property="og:description" content="谢晞鸣的博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="谢晞鸣的博客">
<meta name="twitter:description" content="谢晞鸣的博客">
  
    <link rel="alternative" href="/atom.xml" title="谢晞鸣的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script>
  <script>AV.initialize("t0oo3lf98OPPpD4kenk6vFYf-gzGzoHsz", "FtwKfgFgc5fELEvKhCGUmBBO");</script>
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://wx2.sinaimg.cn/small/6a2787d4ly8fn9hdgyfsbj20dc0dc0uo.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">小谢</a></h1>
		</hgroup>

		
		<p class="header-subtitle">长期内推蚂蚁金服高级开发工程/技术专家，欢迎勾搭</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/fdx321" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/fdx321" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/xie-xi-ming" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:fdx321@126.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/BloomFilter/" style="font-size: 10px;">BloomFilter</a> <a href="/tags/Groovy/" style="font-size: 10px;">Groovy</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Motan/" style="font-size: 16.67px;">Motan</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Netty/" style="font-size: 10px;">Netty</a> <a href="/tags/Nio/" style="font-size: 10px;">Nio</a> <a href="/tags/Python/" style="font-size: 11.67px;">Python</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/RocketMQ/" style="font-size: 15px;">RocketMQ</a> <a href="/tags/RokcetMQ/" style="font-size: 10px;">RokcetMQ</a> <a href="/tags/Scala/" style="font-size: 10px;">Scala</a> <a href="/tags/Scrapy/" style="font-size: 13.33px;">Scrapy</a> <a href="/tags/Spring/" style="font-size: 11.67px;">Spring</a> <a href="/tags/Tomcat/" style="font-size: 18.33px;">Tomcat</a> <a href="/tags/XXL-JOB/" style="font-size: 10px;">XXL-JOB</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/事务/" style="font-size: 10px;">事务</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/博客/" style="font-size: 13.33px;">博客</a> <a href="/tags/可视化/" style="font-size: 10px;">可视化</a> <a href="/tags/收藏/" style="font-size: 10px;">收藏</a> <a href="/tags/爬虫/" style="font-size: 13.33px;">爬虫</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://nba.hupu.com/">虎扑篮球</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.jobbole.com/">伯乐在线</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.importnew.com/">ImportNew</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">某互联网金融公司资浅工程师.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">小谢</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://wx2.sinaimg.cn/small/6a2787d4ly8fn9hdgyfsbj20dc0dc0uo.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">小谢</h1>
			</hgroup>
			
			<p class="header-subtitle">长期内推蚂蚁金服高级开发工程/技术专家，欢迎勾搭</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/fdx321" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/fdx321" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/xie-xi-ming" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:fdx321@126.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-【Tomcat学习笔记】15-Connector" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/14/【Tomcat学习笔记】15-Connector/" class="article-date">
  	<time datetime="2017-07-14T09:50:01.000Z" itemprop="datePublished">2017-07-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/14/【Tomcat学习笔记】15-Connector/">【Tomcat学习笔记】15-Connector</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Connector配置"><a href="#Connector配置" class="headerlink" title="Connector配置"></a><strong>Connector配置</strong></h3><p>Connector 属于 StandardService 里的一个组件，可以在 server.xml 中配置，指定协议、端口、超时时间等。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span>                         </span><br><span class="line"><span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>每个 Service 里可以配置多个 Connector. Tomcat 的 Connector 支持两种协议，HTTP 和 AJP. 关于这两种协议，官方文档如此说：</p>
<ul>
<li><em>The HTTP connector is setup by default with Tomcat, and is ready to use. This connector features the lowest latency and best overall performance.</em></li>
<li><em>When using a single server, the performance when using a native webserver in front of the Tomcat instance is most of the time significantly worse than a standalone Tomcat with its default HTTP connector, even if a large part of the web application is made of static files. If integration with the native webserver is needed for any reason, an AJP connector will provide faster performance than proxied HTTP. AJP clustering is the most efficient from the Tomcat perspective. It is otherwise functionally equivalent to HTTP clustering.</em>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/14/【Tomcat学习笔记】15-Connector/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】14-Cluster" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/12/【Tomcat学习笔记】14-Cluster/" class="article-date">
  	<time datetime="2017-07-12T01:53:18.000Z" itemprop="datePublished">2017-07-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/12/【Tomcat学习笔记】14-Cluster/">【Tomcat学习笔记】14-Cluster</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Tomcat Cluster 这块代码较多，就不贴代码一步步看了，这里从更宏观的视角分析和总结一下。代码主要在 org.apache.catalina.ha 和 org.apache.catalina.tribes 两个package. ha这个package主要做了两件事，或者说Tomcat cluster 主要就做了这两件事：集群间 Session 同步 和 集群War部署。tribes 则是Tomcat 集群通讯模块。</p>
<p><img src="/images/【Tomcat学习笔记】Cluster_1.png" alt=""></p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/12/【Tomcat学习笔记】14-Cluster/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】13-Session" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/04/【Tomcat学习笔记】13-Session/" class="article-date">
  	<time datetime="2017-07-04T12:25:38.000Z" itemprop="datePublished">2017-07-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/04/【Tomcat学习笔记】13-Session/">【Tomcat学习笔记】13-Session</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>说明，为了简洁，这里贴的代码可能有所删减。</em></p>
<h3 id="1-Session入门"><a href="#1-Session入门" class="headerlink" title="1. Session入门"></a><strong>1. Session入门</strong></h3><p>网上会经常看到介绍Session和Cookie区别的文章，当年我也傻傻的看过，然这两个根本不是一个东西，有啥好比较的，简直就好比问TCP和JAVA的区别。</p>
<p>Session 是什么？我就不去抄维基百科了，谢晞鸣的理解：HTTP协议本身是无状态的（所谓无状态，就是指前后两HTTP请求是独立的，后面的HTTP请求没法知道前面那次做了啥），但在很多场景中，我们需要有状态，比如用户的登录态，而 Session 就是这样一种让应用有状态的机制。</p>
<p>Session 最简单的用法是:<br>【1】在登录方法中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Boolean isLogin = login(userId, password)</span><br><span class="line"><span class="keyword">if</span>(isLogin) &#123;</span><br><span class="line">    HttpSession session = request.getSession();</span><br><span class="line">    session.setAttribute(<span class="string">"userId"</span>, userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/07/04/【Tomcat学习笔记】13-Session/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】12-Tomcat的Mapper机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/29/【Tomcat学习笔记】12-Tomcat的Mapper机制/" class="article-date">
  	<time datetime="2017-06-29T13:18:31.000Z" itemprop="datePublished">2017-06-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/29/【Tomcat学习笔记】12-Tomcat的Mapper机制/">【Tomcat学习笔记】12-Tomcat的Mapper机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>说明，为了简洁，这里贴的代码可能有所删减。</em></p>
<p><a href="https://fdx321.github.io/2017/05/16/%E3%80%90Tomcat%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%912-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/#more" target="_blank" rel="noopener">【Tomcat学习笔记】2-整体架构</a> 中有介绍过 Tomcat 中 Engine、Host、Context、Wrapper 这四个组件的关系。还是以 <a href="http://www.mydomain.com/app/index.html" target="_blank" rel="noopener">http://www.mydomain.com/app/index.html</a> 为例。</p>
<p><img src="/images/【Tomcat学习笔记】整体架构_3.jpg" alt="300"><br> 当我们访问这个网址的时候，Tomcat 如何一步步路由找到对应的 Host、Context、Wrapper 的呢？Tomcat 中维护了一个 <strong>Mapper</strong>，在收到 Http 请求后，会去 Mapper 中查找对应的 Host、Context 和 Wrapper，放到 request 的 <strong>MappingData</strong> 中一路带下去。</p>
<h3 id="Mapper的构建过程"><a href="#Mapper的构建过程" class="headerlink" title="Mapper的构建过程 "></a><strong>Mapper的构建过程</strong>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/06/29/【Tomcat学习笔记】12-Tomcat的Mapper机制/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】11-Tomcat中JMX的使用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/15/【Tomcat学习笔记】11-Tomcat中JMX的使用/" class="article-date">
  	<time datetime="2017-06-15T11:03:39.000Z" itemprop="datePublished">2017-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/15/【Tomcat学习笔记】11-Tomcat中JMX的使用/">【Tomcat学习笔记】11-Tomcat中的JMX</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="JMX-科普"><a href="#JMX-科普" class="headerlink" title="JMX 科普"></a><strong>JMX 科普</strong></h3><p>JMX（Java Management Extensions）其实就是一套标准，定义了一套架构（设计模式或者说API）用于管理和监控Java应用程序。<a href="http://docs.oracle.com/javase/6/docs/technotes/guides/jmx/overview/intro.html#wp5529" target="_blank" rel="noopener">JMX官方介绍</a></p>
<p><img src="/images/【Tomcat学习笔记】Tomcat中JMX的使用_1.png" alt=""><br>这是 JMX 的架构，可以通过各种协议接入进来，然后通过 MBeanServer 操作各个 MBean.</p>
<p>这里的 MBean 分为静态Bean和动态Bean，静态Bean能力有限，只能用于获取一些静态信息。动态Bean, 可以在运行时改变它的属性，执行它的方法，动态Bean，必须继承 DynamicMBean 接口，动态 Bean 会定义 MBeanAttributeInfo（属性信息）/ MBeanOperationInfo（方法信息）等，然后一起注册到 MBeanServer 中去，使用的时候通过MBServer 获取该 MBean, 拿到属性信息或方法信息，然后通过反射的方式去动态的改变属性，执行方法。</p>
<p>关于DynamicBean最基础的用法可以参考<a href="http://damies.iteye.com/blog/51799" target="_blank" rel="noopener">动态MBean：DynamicMBean</a></p>
<p>后面的介绍假设你已经了解JMX了基本概念和使用方法，
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/06/15/【Tomcat学习笔记】11-Tomcat中JMX的使用/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】10-代码变更时自动部署" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/30/【Tomcat学习笔记】10-代码变更时自动部署/" class="article-date">
  	<time datetime="2017-05-30T13:31:19.000Z" itemprop="datePublished">2017-05-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/30/【Tomcat学习笔记】10-代码变更时自动部署/">【Tomcat学习笔记】10-代码变更时自动部署</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>一直在入门，但从未精通，所以不敢说深入分析 XXX，顶多就是一个学习笔记，但是是原创，转载请注明出处，好吧，说的好像有人会看一样。</em><br><em>说明，为了简洁，这里贴的代码都有所删减。</em></p>
<p>在看 ClassLoader 代码的过程中，我发现了 WebappLoader 的 reloadable 属性，通过分析代码，把自动部署的过程摸清楚了。这个属性在开发过程中挺有用的，有时候在Debug的时候改了代码，重启Tomcat又要等半天，reloadable 这个属性就可以派上用场了。</p>
<p>每个 Container 在start的最后，都会执行这样一段代码，ContainerBase#threadStart.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">threadStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (thread != <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (backgroundProcessorDelay &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    threadDone = <span class="keyword">false</span>;</span><br><span class="line">    String threadName = <span class="string">"ContainerBackgroundProcessor["</span> + toString() + <span class="string">"]"</span>;</span><br><span class="line">    thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ContainerBackgroundProcessor(), threadName);</span><br><span class="line">    thread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/05/30/【Tomcat学习笔记】10-代码变更时自动部署/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】9-ClassLoader" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/30/【Tomcat学习笔记】9-ClassLoader/" class="article-date">
  	<time datetime="2017-05-30T10:03:39.000Z" itemprop="datePublished">2017-05-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/30/【Tomcat学习笔记】9-ClassLoader/">【Tomcat学习笔记】9-ClassLoader</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>一直在入门，但从未精通，所以不敢说深入分析 XXX，顶多就是一个学习笔记，但是是原创，转载请注明出处，好吧，说的好像有人会看一样。</em><br><em>说明，为了简洁，这里贴的代码都有所删减。</em></p>
<p>先来张图：<br><img src="/images/【Tomcat学习笔记】ClassLoader_1.svg"></p>
<h3 id="ClassLoader基础"><a href="#ClassLoader基础" class="headerlink" title="ClassLoader基础"></a><strong>ClassLoader基础</strong></h3><p>Java 自带了三个类加载器，BootstrapClassLoader、ExtClassLoader 和 AppClassLoader，它们之间的层级关系如图，上面的 ClassLoader 是下面 ClassLoader 的 parent.不同的 ClassLoader 有不同的职责：</p>
<ul>
<li>BootstrapClassLoader, 引导类加载器，加载JDK最核心的类，比如 rt.jar, java.lang.String, java.lang.Integer 这些类都在这个 JAR 中</li>
<li>ExtClassLoader, 扩展类加载器，加载 jre/lib/ext 目录下的类</li>
<li>AppClassLoader, 系统类加载器，加载应用程序 classpath 目录下的所有jar和class文件</li>
</ul>
<p>如果想看 ClassLoader 具体加载了哪些类，可以 getURLs, 然后将它们打印出来<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URL[] urls = sun.misc.Launcher.getBootstrapClassPath().getURLs();</span><br><span class="line">URL[] urls = ((URLClassLoader)Thread.currentThread().getContextClassLoader()).getURLs();</span><br></pre></td></tr></table></figure></p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/05/30/【Tomcat学习笔记】9-ClassLoader/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-【Tomcat学习笔记】8-Context创建过程（应用的部署过程）" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/22/【Tomcat学习笔记】8-Context创建过程（应用的部署过程）/" class="article-date">
  	<time datetime="2017-05-22T10:50:28.000Z" itemprop="datePublished">2017-05-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/22/【Tomcat学习笔记】8-Context创建过程（应用的部署过程）/">【Tomcat学习笔记】8-Context创建过程（应用的部署过程）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前说过，Context 和 Wrapper 的创建和其他组件的创建过程有点不一样，这两者没有在 server.xml 中配置，并不是在解析 server.xml 的时候创建的. 谢晞鸣 Debug 代码，发现。。。</p>
<p>HostConfig 是 StandardHost 的一个 LifeCycleListener，在 StandardHost start 的时候，会触发 START_EVENT 事件，<br>HostConfig 监听到该事件后，。。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HostConfig#start</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ....</span><br><span class="line">    <span class="keyword">if</span> (host.getDeployOnStartup())</span><br><span class="line">        deployApps();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2017/05/22/【Tomcat学习笔记】8-Context创建过程（应用的部署过程）/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/tags/Tomcat/page/2/">2</a><a class="extend next" rel="next" href="/tags/Tomcat/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 小谢
    	</div>
      <span id="access-count">
      </span>
      <div class="footer-right">
      	<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      </div>
    </div>
  </div>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: false,
		isArchive: false,
		isTag: true,
		isCategory: false,
		open_in_new: true
	}
</script>
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!--page counter part-->
<script>
function addCount (Counter) {
        var query1=new AV.Query(Counter);
        query1.equalTo("url","totalCount");
        query1.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("url","totalCount");
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                          console.log('New object created');
                        },
                        error: function(newcounter,error){
                          console.log('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                console.log('Error:'+error.code+" "+error.message);
            }
        });

        url=$('.article-date').attr('href').trim();
        title = $('.article-title').text().trim();
        var query2=new AV.Query(Counter);
        query2.equalTo("url",url);
        query2.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("title",title);
                    newcounter.set("url",url);
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                          console.log('New object created');
                        },
                        error: function(newcounter,error){
                          console.log('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                console.log('Error:'+error.code+" "+error.message);
            }
        });
}
$(function(){
        var Counter=AV.Object.extend("Counter");
        //only increse visit counting when intering a page
        if ($('.article-title').length == 1){
           addCount(Counter);
         }

        var query=new AV.Query(Counter);
        query.equalTo("url","totalCount");
        query.find({
            success: function(results){
              $('#access-count').text(results[0].get('time'));
            },
            error: function(error){
                console.log("Error:"+error.code+" "+error.message);
            }
        });
});
</script>

  </div>
</body>
</html>